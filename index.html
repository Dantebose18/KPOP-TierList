<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Music Tier List</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f6f7f9;
  --card:#ffffff;
  --text:#1f2937;
  --border:#e5e7eb;
}

body.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#f8fafc;
  --border:#334155;
}

body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:20px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}

button,input,select{
  padding:10px 14px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:14px;
}

button{cursor:pointer}
button.primary{background:#111;color:white;border:none}

.main{
  max-width:1300px;
  margin:auto;
  padding-bottom:200px;
}

/* --------- TIER TITLE EDITABLE --------- */

.tierlist-title{
  font-size:28px;
  font-weight:600;
  margin:20px 0;
  border:none;
  background:transparent;
  color:var(--text);
}

/* --------- TIERS --------- */

.tier{
  background:var(--card);
  border-radius:18px;
  margin-bottom:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}

.tier-header{
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px;
  border-radius:18px 18px 0 0;
  color:white;
}

.tier-header input[type=text]{
  background:rgba(255,255,255,0.2);
  border:none;
  color:white;
  font-weight:600;
  width:100px;
}

.cards{
  display:flex;
  gap:14px;
  padding:14px;
  flex-wrap:wrap;
  min-height:140px;
}

/* --------- BIGGER CARDS --------- */

.card{
  width:140px;
  height:140px;
  border-radius:16px;
  background-size:cover;
  background-position:center;
  position:relative;
  cursor:grab;
  transition:transform .15s ease;
}

.card.dragging{
  opacity:0.5;
  transform:scale(1.05);
}

.card-overlay{
  position:absolute;
  bottom:0;
  width:100%;
  padding:8px;
  background:linear-gradient(to top,rgba(0,0,0,.8),transparent);
  color:white;
  font-size:12px;
  border-radius:0 0 16px 16px;
}

.card button{
  position:absolute;
  top:6px;
  right:6px;
  background:rgba(0,0,0,.6);
  border:none;
  color:white;
  border-radius:6px;
  padding:2px 6px;
  cursor:pointer;
}

/* --------- POOL FIXED --------- */

.pool-container{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:var(--bg);
  padding:14px;
  border-top:2px solid var(--border);
  box-shadow:0 -6px 20px rgba(0,0,0,0.08);
}

.pool-title{
  margin:0 0 10px 0;
  font-weight:600;
}

.pool{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  min-height:150px;
}

</style>
</head>

<body>

<header>
  <button onclick="addTier()">âž• Tier</button>
  <button onclick="addTierList()">ðŸ‘¥ Tier List</button>
  <button onclick="toggleDark()">ðŸŒ™</button>
  <button onclick="exportPNG()">ðŸ“¤ Export</button>
</header>

<div class="main">

<input class="tierlist-title" id="tierListTitle">

<div style="display:flex;gap:12px;margin-bottom:25px;">
  <input id="artistInput" placeholder="Artiste">
  <input id="titleInput" placeholder="Titre de la chanson">
  <button class="primary" onclick="addSong()">Ajouter</button>
</div>

<div id="tiers"></div>

</div>

<!-- POOL FIXED -->
<div class="pool-container">
  <h3 class="pool-title">ðŸŽµ Pool</h3>
  <div class="pool" id="pool"></div>
</div>

<script>
let tierLists=JSON.parse(localStorage.getItem('tierLists'))||[
{
  name:'Ma Tier List',
  tiers:[
    {id:'S',name:'S',color:'#ef4444',songs:[]},
    {id:'A',name:'A',color:'#22c55e',songs:[]},
    {id:'B',name:'B',color:'#eab308',songs:[]},
    {id:'C',name:'C',color:'#9ca3af',songs:[]}
  ],
  pool:[]
}];

let current=0;
let dragged=null;

function save(){
  localStorage.setItem('tierLists',JSON.stringify(tierLists));
}

/* --------- RENDER --------- */

function render(){
  const list=tierLists[current];
  document.getElementById('tierListTitle').value=list.name;

  const tiers=document.getElementById('tiers');
  tiers.innerHTML='';

  list.tiers.forEach(t=>{
    const tier=document.createElement('div');
    tier.className='tier';

    const header=document.createElement('div');
    header.className='tier-header';
    header.style.background=t.color;

    const name=document.createElement('input');
    name.type='text';
    name.value=t.name;
    name.oninput=e=>{t.name=e.target.value;save();};

    const color=document.createElement('input');
    color.type='color';
    color.value=t.color;
    color.onchange=e=>{
      t.color=e.target.value;
      header.style.background=t.color;
      save();
    };

    const del=document.createElement('button');
    del.textContent='âŒ';
    del.onclick=()=>{
      list.tiers=list.tiers.filter(x=>x.id!==t.id);
      save();
      render();
    };

    header.append(name,color,del);

    const cards=document.createElement('div');
    cards.className='cards';
    cards.ondragover=e=>e.preventDefault();
    cards.ondrop=()=>dropSong(t.id);

    t.songs.forEach(s=>cards.appendChild(createCard(s)));

    tier.append(header,cards);
    tiers.appendChild(tier);
  });

  renderPool();
}

function renderPool(){
  const list=tierLists[current];
  const pool=document.getElementById('pool');
  pool.innerHTML='';
  pool.ondragover=e=>e.preventDefault();
  pool.ondrop=()=>dropSong(null);
  list.pool.forEach(s=>pool.appendChild(createCard(s)));
}

/* --------- CARD --------- */

function createCard(song){
  const c=document.createElement('div');
  c.className='card';
  c.draggable=true;
  c.style.backgroundImage=`url(${song.cover||''})`;

  c.ondragstart=e=>{
    dragged=song;
    c.classList.add('dragging');
  };

  c.ondragend=()=>{
    c.classList.remove('dragging');
    dragged=null;
  };

  c.ondblclick=()=>{
    const newArtist=prompt("Modifier artiste",song.artist);
    const newTitle=prompt("Modifier titre",song.title);
    if(newArtist) song.artist=newArtist;
    if(newTitle) song.title=newTitle;
    save();
    render();
  };

  const overlay=document.createElement('div');
  overlay.className='card-overlay';
  overlay.innerHTML=`<strong>${song.artist}</strong><br>${song.title}`;

  const del=document.createElement('button');
  del.textContent='ðŸ—‘ï¸';
  del.onclick=()=>deleteSong(song.id);

  c.append(overlay,del);
  return c;
}

/* --------- DRAG LOGIC --------- */

function dropSong(tierId){
  if(!dragged) return;

  const list=tierLists[current];

  list.pool=list.pool.filter(s=>s!==dragged);
  list.tiers.forEach(t=>t.songs=t.songs.filter(s=>s!==dragged));

  if(tierId===null){
    list.pool.push(dragged);
  }else{
    list.tiers.find(t=>t.id===tierId).songs.push(dragged);
  }

  save();
  render();
}

/* --------- SONG --------- */

async function addSong(){
  const artist=document.getElementById('artistInput').value.trim();
  const title=document.getElementById('titleInput').value.trim();
  if(!artist||!title)return;

  const res=await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(title+' '+artist)}&entity=song&limit=1`);
  const data=await res.json();
  const cover=data.results[0]?.artworkUrl100?.replace('100x100','300x300')||'';

  tierLists[current].pool.push({
    id:Date.now()+Math.random(),
    artist,
    title,
    cover
  });

  document.getElementById('artistInput').value='';
  document.getElementById('titleInput').value='';

  save();
  render();
}

/* --------- OTHER --------- */

function deleteSong(id){
  const list=tierLists[current];
  list.pool=list.pool.filter(s=>s.id!==id);
  list.tiers.forEach(t=>t.songs=t.songs.filter(s=>s.id!==id));
  save();
  render();
}

function addTier(){
  const n=prompt("Nom du tier");
  if(!n)return;
  tierLists[current].tiers.push({id:Date.now(),name:n,color:'#3b82f6',songs:[]});
  save();
  render();
}

function addTierList(){
  const n=prompt("Nom de la tier list");
  if(!n)return;
  tierLists.push(JSON.parse(JSON.stringify(tierLists[0])));
  tierLists.at(-1).name=n;
  current=tierLists.length-1;
  save();
  render();
}

document.getElementById('tierListTitle').oninput=e=>{
  tierLists[current].name=e.target.value;
  save();
};

function toggleDark(){
  document.body.classList.toggle('dark');
}

function exportPNG(){
  html2canvas(document.body).then(c=>{
    const a=document.createElement('a');
    a.download='tierlist.png';
    a.href=c.toDataURL();
    a.click();
  });
}

render();
</script>
</body>
</html>
